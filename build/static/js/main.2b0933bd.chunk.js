(window["webpackJsonpbaby-monitor"]=window["webpackJsonpbaby-monitor"]||[]).push([[0],{18:function(e,n,t){e.exports=t(36)},23:function(e,n,t){},35:function(e,n,t){},36:function(e,n,t){"use strict";t.r(n);var a=t(0),o=t.n(a),c=t(14),l=t.n(c),r=(t(13),t(23),t(1)),i=t(2),s=t(4),f=t(3),u=t(5),d=t(16),h=t.n(d),m=function(e){function n(){var e,t;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(t=Object(s.a)(this,(e=Object(f.a)(n)).call.apply(e,[this].concat(o)))).state={result:""},t.handleScan=function(e){e&&t.setState(function(n){var t=n.result;if(!t.includes(e))return{result:t.concat(e)}})},t.handleError=function(e){console.error(e)},t}return Object(u.a)(n,e),Object(i.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{style:{margin:"20px auto"}},o.a.createElement(h.a,{delay:600,onError:this.handleError,onScan:this.handleScan,style:{width:"100%",maxWidth:"400px",margin:"0 auto"}}),o.a.createElement("p",null,this.state.result))}}]),n}(o.a.Component),v=t(17),p=t.n(v);var g=function(e){function n(){var e,t;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(t=Object(s.a)(this,(e=Object(f.a)(n)).call.apply(e,[this].concat(o)))).state={input:""},t.handleChange=function(e){var n=function(e,n){for(var t=Math.ceil(e.length/n),a=new Array(t),o=0,c=0;o<t;++o,c+=n)a[o]=e.substr(c,n);return a}(e.target.value,400);console.log("chunks",n),n.forEach(function(e,n){setTimeout(function(){return t.setState({input:e})},1500*n)})},t}return Object(u.a)(n,e),Object(i.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{style:{margin:"20px auto"}},o.a.createElement(p.a,{level:"L",size:400,value:this.state.input}),o.a.createElement("p",null,o.a.createElement("input",{onChange:this.handleChange})))}}]),n}(o.a.Component),b=function(e){function n(){var e;Object(r.a)(this,n),(e=Object(s.a)(this,Object(f.a)(n).call(this))).setLocalOffer=function(){e.chatEnabled&&(e._chatChannel=e.pc.createDataChannel("chatChannel"),e._fileChannel=e.pc.createDataChannel("fileChannel"),e.chatChannel(e._chatChannel),e.fileChannel(e._fileChannel)),e.pc.createOffer().then(function(n){console.log("createOffer ok "),e.pc.setLocalDescription(n).then(function(){setTimeout(function(){"complete"!==e.pc.iceGatheringState&&(console.log("after GetherTimeout"),e.localOffer.value=JSON.stringify(e.pc.localDescription))},2e3),console.log("setLocalDescription ok")}).catch(e.errHandler)}).catch(e.errHandler)},e.fileChannel=function(n){e._fileChannel.onopen=function(e){console.log("file channel is open",e)},e._fileChannel.onmessage=function(n){var t,a=Object.prototype.toString.call(n.data);if("[object ArrayBuffer]"===a){if(t=n.data,e.receiveBuffer.push(t),e.receivedSize+=t.byteLength,e.recFileProg.value=e.receivedSize,e.receivedSize===e.recFileDom.size){var o=new window.Blob(e.receiveBuffer);e.file_download.href=URL.createObjectURL(o),e.file_download.innerHTML="download",e.file_download.download=e.recFileDom.name,e.receiveBuffer=[],e.receivedSize=0}}else"[object String]"===a?t=JSON.parse(n.data):"[object Blob]"===a&&(t=n.data,e.file_download.href=URL.createObjectURL(t),e.file_download.innerHTML="download",e.file_download.download=e.recFileDom.name);if(t.fileInfo){if("areYouReady"===t.fileInfo){e.recFileDom=t,e.recFileProg.max=t.size;var c=JSON.stringify({fileInfo:"readyToReceive"});e._fileChannel.send(c),window.timer=setInterval(function(){e.stats()},1e3)}else"readyToReceive"===t.fileInfo&&(e.sendFileProg.max=e.sendFileDom.size,e.sendFileinChannel());console.log("_fileChannel: ",t.fileInfo)}},e._fileChannel.onclose=function(){console.log("file channel closed")}},e.stats=function(){e.pc.getStats(null,function(n){for(var t in n){var a=n[t];if(console.log(a.type,a.googActiveConnection),"googCandidatePair"===a.type&&"true"===a.googActiveConnection){var o=a.bytesReceived;console.log("bit rate",o-e.bytesPrev),e.bytesPrev=o}}})},e.enableChat=function(){e.enable_chat.checked?e.chatEnabled=!0:e.chatEnabled=!1},e.sendMsg=function(){var n=e.sendTxt.value;return e.chat.innerHTML=e.chat.innerHTML+"<pre class=sent>"+n+"</pre>",e._chatChannel.send(n),e.sendTxt.value="",!1},e.sendFileinChannel=function(){!function n(t){var a=new window.FileReader;a.onload=(e.file,function(a){e._fileChannel.send(a.target.result),e.file.size>t+a.target.result.byteLength&&window.setTimeout(n,0,t+16384),e.sendFileProg.value=t+a.target.result.byteLength});var o=e.file.slice(t,t+16384);a.readAsArrayBuffer(o)}(0)},e.audioRTC=function(n){console.log("streamAudioFile"),e.context=new AudioContext;var t=e.streamAudioFile.files[0];if(t&&t.type.match("audio*")){var a=new FileReader;a.onload=function(t){e.context.decodeAudioData(t.target.result,function(t){var a=e.context.createBufferSource();a.buffer=t,a.start(0),a.connect(e.context.destination);var o=e.context.createMediaStreamDestination();a.connect(o),window.localStream=o.stream,n({status:"success",stream:!0})})},a.readAsArrayBuffer(t)}},e.sendFile=function(){if(e.fileTransfer.value){var n=JSON.stringify(e.sendFileDom);e._fileChannel.send(n),console.log("file info sent")}},e.errHandler=function(e){console.log(e)};return e.pc=new RTCPeerConnection({iceServers:[{urls:[]}]}),e.localStream=void 0,e.chatEnabled=void 0,e._fileChannel=void 0,e.context=void 0,e.source=void 0,e._chatChannel=void 0,e.context=void 0,e.sendFileDom={},e.recFileDom={},e.receiveBuffer=[],e.receivedSize=0,e.file=void 0,e.bytesPrev=0,e}return Object(u.a)(n,e),Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(n){console.log("stream",n),e.localStream=n,e.micused.innerHTML=e.localStream.getAudioTracks()[0].label,e.pc.addStream(n);try{e.local.srcObject=n}catch(t){e.local.src=window.URL.createObjectURL(n)}e.local.muted=!0}).catch(this.errHandler),this.pc.ondatachannel=function(n){"fileChannel"===n.channel.label&&(console.log("fileChannel Received -",n),e._fileChannel=n.channel,e.fileChannel(n.channel)),"chatChannel"===n.channel.label&&(console.log("chatChannel Received -",n),e._chatChannel=n.channel,e.chatChannel(n.channel))},this.pc.onicecandidate=function(n){var t=n.candidate;console.log("onicecandidate",e),t?console.log(t.candidate):(console.log("iceGatheringState complete",e.pc.localDescription.sdp),e.localOffer.value=JSON.stringify(e.pc.localDescription))},this.pc.oniceconnectionstatechange=function(){console.log("iceconnectionstatechange: ",e.pc.iceConnectionState)},this.pc.onaddstream=function(n){console.log("remote onaddstream",n.stream);try{e.remote.srcObject=n.stream}catch(t){e.remote.src=window.URL.createObjectURL(n.stream)}},this.pc.onconnection=function(e){console.log("onconnection ",e)},this.streamAudioFile.onchange=function(){console.log("streamAudioFile"),e.context=new AudioContext;var n=e.streamAudioFile.files[0];if(n&&n.type.match("audio*")){var t=new FileReader;t.onload=function(n){e.context.decodeAudioData(n.target.result,function(n){e.source=e.context.createBufferSource(),e.source.buffer=n,e.source.start(0),e.source.connect(e.context.destination);var t=e.context.createMediaStreamDestination();e.source.connect(t),e.local.srcObject=t.stream,e.local.muted=!0,e.pc.addStream(t.stream)})},t.readAsArrayBuffer(n)}},this.fileTransfer.onchange=function(n){var t=e.fileTransfer.files;t.length>0?(e.file=t[0],e.sendFileDom.name=e.file.name,e.sendFileDom.size=e.file.size,e.sendFileDom.type=e.file.type,e.sendFileDom.fileInfo="areYouReady",console.log(e.sendFileDom)):console.log("No file selected")},this.remoteOfferGot.onclick=function(){var n=new RTCSessionDescription(JSON.parse(e.remoteOffer.value));console.log("remoteOffer \n",n),e.pc.setRemoteDescription(n).then(function(){console.log("setRemoteDescription ok"),"offer"===n.type&&e.pc.createAnswer().then(function(n){console.log("createAnswer 200 ok \n",n),e.pc.setLocalDescription(n).then(function(){}).catch(e.errHandler)}).catch(e.errHandler)}).catch(e.errHandler)},this.enableChat()}},{key:"chatChannel",value:function(e){var n=this;this._chatChannel.onopen=function(e){console.log("chat channel is open",e)},this._chatChannel.onmessage=function(e){n.chat.innerHTML=n.chat.innerHTML+"<pre>"+e.data+"</pre>"},this._chatChannel.onclose=function(){console.log("chat channel closed")}}},{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",ref:function(n){e.enable_chat=n},onClick:this.enableChat,defaultChecked:!0}),"> Enable chat",o.a.createElement("span",{ref:function(n){e.micused=n},style:{right:0,position:"fixed"}})),o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement("video",{ref:function(n){e.local=n},width:250,controls:!0,autoPlay:!0}),"Local",o.a.createElement("textarea",{rows:"4",cols:"50",ref:function(n){e.localOffer=n}}),o.a.createElement("button",{ref:function(n){e.localOfferSet=n},onClick:this.setLocalOffer},"CreateOffer"))),o.a.createElement("div",null,o.a.createElement("h4",null,"LocalStream"),o.a.createElement("input",{type:"checkbox",ref:function(n){e.enableAudioFile=n}}),"Audio File",o.a.createElement("input",{type:"file",ref:function(n){e.streamAudioFile=n}}),o.a.createElement("br",null),o.a.createElement("input",{type:"checkbox",ref:function(n){e.enable_mic=n},defaultChecked:!0}),"Microphone"),o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement("video",{width:250,ref:function(n){e.remote=n},controls:!0,autoPlay:!0}),"Remote",o.a.createElement("textarea",{ref:function(n){e.remoteOffer=n},rows:"4",cols:"50",placeholder:"Paste remote SDP"}),o.a.createElement("button",{ref:function(n){e.remoteOfferGot=n}},"Answer"))),o.a.createElement("div",{ref:function(n){e.chat=n},style:{overflow:"scroll"}}),o.a.createElement("div",null,o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("form",{action:""},o.a.createElement("input",{ref:function(n){e.sendTxt=n},type:"text",name:"",placeholder:"chat here",size:"50"}),o.a.createElement("button",{type:"button",onClick:this.sendMsg},"send"))),o.a.createElement("div",null,o.a.createElement("p",null,"File transfer:"),o.a.createElement("div",null,o.a.createElement("progress",{value:"0",ref:function(n){e.sendFileProg=n}}),o.a.createElement("input",{type:"file",name:"",ref:function(n){e.fileTransfer=n}}),o.a.createElement("button",{type:"submit",onClick:this.sendFile},"send")),o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement("progress",{value:"0",ref:function(n){e.recFileProg=n}}),o.a.createElement("button",{ref:function(n){e.file_download=n}},"File Download")))))}}]),n}(o.a.Component),C=(t(35),function(e){function n(){var e,t;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(t=Object(s.a)(this,(e=Object(f.a)(n)).call.apply(e,[this].concat(o)))).state={unit:"baby"},t.handleClick=function(e){var n=e.target.dataset.unit;t.setState({unit:n})},t}return Object(u.a)(n,e),Object(i.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement("div",{id:"debug"}),"baby"===this.state.unit?o.a.createElement(g,null):o.a.createElement(m,null),o.a.createElement("button",{onClick:this.handleClick,"data-unit":"baby"},"Baby Unit"),o.a.createElement("button",{onClick:this.handleClick,"data-unit":"parent"},"Parent Unit"),o.a.createElement(b,null))}}]),n}(o.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(o.a.createElement(C,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[18,1,2]]]);
//# sourceMappingURL=main.2b0933bd.chunk.js.map